# Pavel's Custom Input View Widget

So the initial implementation is a fork of the viewCell, with a few changes to the app spec and associated changes on the narrative front and back end to allow these changes.

I'll provide better documentation about how it works, but for now the pieces are described below, and the code should serve as examples / starting places.

The example custom input and output widgets are at their core very simple, but made a bit more complex just to demonstrate dealing with structured data from an input. The general shape of the modules is somewhat fixed, but may chage a bit. I just realized that the Pet.js custom input interface is from kbase-ui, and will need to be simplified a bit.

## The Pieces

- sample sdk service containing the two changes needed to supporte the custom input
- narrative on branch ... custom-input-view-cell
- where to put the widgets
- where the widget wrapper is


## Sample SDK Service

I set up a simple sdk service at https://github.com/eapearson/eapearson_customInputDev.

It is very simple, does nothing on the back end, and includes just the minimal amount of config necessary to tease out and demonstrate the changes.

The relevant bits are:

1. New app_type "advanced_viewer"

https://github.com/eapearson/eapearson_customInputDev/blob/master/ui/narrative/methods/validate_custom_input/spec.json#L8

Probably the advanced_viewer will collapse back down to the plain viewer when we are finished with this effort.

2. Ouptut widget "CustomOutputDemo"

https://github.com/eapearson/eapearson_customInputDev/blob/master/ui/narrative/methods/validate_custom_input/spec.json#L11

Should have named that "PetOutput" probably, based on the validate_as below. 

3. New field type "custom"

https://github.com/eapearson/eapearson_customInputDev/blob/master/ui/narrative/methods/validate_custom_input/spec.json#L32

4. New text_options.validate_as "Pet" - whatever you want it to be

https://github.com/eapearson/eapearson_customInputDev/blob/master/ui/narrative/methods/validate_custom_input/spec.json#L34

The latter will need to be set up in the Narrative as described below. Essentially the "custom" field type has a dispatcher to an input widget based on the value of "validate_as".


## Narrative Changes

The narrative with changes is at https://github.com/eapearson/narrative/tree/TASK-559-custom-input-view-cell.

The new cell type is "advancedViewCell" and is located in nbextensions/advancedViewCell. It is a fork of the viewCell, with changes to accomodate the custom input widget, the output widget state saving and restoration. It also is a start at cleaning up the view cell, so I've been doing lots of paring out of code that was frozen in place earlier. Expect more changes to come.

The relevant bits for wedging in new code:

1. custom input module

They live in 

narrative/kbase-extension/static/kbase/js/widgets/appWidgets2/input/customInputs

E.g.

narrative/kbase-extension/static/kbase/js/widgets/appWidgets2/input/customInputs/petInput.js

The input widget module files are all named typeInput.js, so this is in keeping with that practice, where type in this case is the value of "validate_as".

This is experimental and will probably change. E.g. it should be input/custom rather than input/customInputs.

2. custom input validate_as to module mapping

Right now hard-coded in 

/Users/erik/work/kbase/sprints/implementation_team_0317/pavel_custom_input/narrative/kbase-extension/static/kbase/js/widgets/appWidgets2/input/customInput.js

but I have a pending change to make the module loading dynamic based on typeInput.js as mentioned above. So for the next day or so it needs to be manually managed in this file, but will be automatic very soon.

3. custom input wrapper (wip)

The same module:


/Users/erik/work/kbase/sprints/implementation_team_0317/pavel_custom_input/narrative/kbase-extension/static/kbase/js/widgets/appWidgets2/input/customInput.js

acts as a wrapper for the custom input. It is bare bones and will need some work. For instance, I did not pay attention to any error or validation display or propagation issues.

4. 



## TODO

More paring and alignment of code in advancedViewCell

Exposing more api 

jquery based widget invocation?

better (some) error handling

linking of custom input and output widgets back to module, or at least a less coupled method than maintaining them inside the narrative codebase.

layout - optimize it strictly for this case, or keep it generic so that it can be folded back into viewCell?

any need to utilize the types in the main app spec in relation to the data generated by the custom input and consumed by the output widget? In theory, it should/could comply with the spec, but in practice it does not need to since custom parameters are not validated in the front or back end of the narrative, and they are never sent to the service (where for java services they would fail.)

view-only custom input


## TODO Today

- make field wrapper super-compact, basically completely bare. Should preserve error reporting area,though.

- custom input not hard-coded

- extra credit: simple system for remote-loading custom input + output widgets

- if already run, open with input closed