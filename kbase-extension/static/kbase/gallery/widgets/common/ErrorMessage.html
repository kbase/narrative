<!DOCTYPE html>
<html >
    <head>
    <script src="/narrative/static/components/requirejs/require.js"></script>
    <script src="/narrative/static/kbase/gallery/common.js"></script>
    <link type="text/css" rel="stylesheet" href="/narrative/static/style/style.min.css">
    <link type="text/css" rel="stylesheet" href="/narrative/static/kbase/gallery/common.css">
    <link type="text/css" rel="stylesheet" href="/narrative/static/kbase/css/all_concat.css">
    <meta charset="utf-8">
        <title>KBase Demo - AlertMessage.js</title>
    </head>
    <body class="Demo">
       <h1>ErrorMessage Demo</h1>

        <p><a href="../../index.html">Index</a></p>

        <h2>From String</h2>
                    
        <p>The very simplest error message is a string</p>

        <div class="Example">
          <div id="errormessage1"></div>
        </div>

        <h2>From Error exception object</h2>

        <p>Any Error that is not specifically handled and is descended from Error</p>

        <div class="Example">
          <div id="errormessage2"></div>
        </div>

        <h2>From jsonrpc/1.1/errors - non-JSONRPC api errors</h2>

        <p>An Error that is generated by an RPC call from the jsonrpc/1.1 clients, but is due to
           http usage, not the RPC itself.</p>

        <div class="Example">
          <div id="errormessage3"></div>
        </div>

        <h2>From jsonrpc/1.1/jsonrpcErrors - JSONRPC api errors</h2>

        <p>An Error that is generated by an RPC call from the jsonrpc/1.1 clients.</p>

        <div class="Example">
          <div id="errormessage3b"></div>
        </div>

         <h2>From kb_common/jsonRpc - JSONRPC api errors</h2>

        <p>An Error that is generated by an RPC call from the kb_common/jsonRpc clients, and is an
        RPC error thrown by the service.</p>

        <div class="Example">
          <div id="errormessage4"></div>
        </div>

        <h2>Edge Case: null</h2>

        <p>What if an error object is "null"?</p>

        <div class="Example">
          <div id="errormessage5"></div>
        </div>

        <h2>Edge Case: Date</h2>

        <p>What if an error object is any other kind of object, e.g. Date?</p>

        <div class="Example">
          <div id="errormessage6"></div>
        </div>

        <h2>Edge Case: plain object with "message" property</h2>

        <p>What if an error object is a plain object with a string property named "message"?</p>

                <div class="Example">
          <div id="errormessage7"></div>
        </div>


        <h2>Edge Case: object with "message" property and "toJSON" method</h2>

        <p>What if an error object is an object with a "message" property and a method "toJSON()"?</p>

        <div class="Example">
          <div id="errormessage8"></div>
        </div>

        <h2>Edge Case: pass in a boolean</h2>

        <p>What if an error object is any other kind of value, e.g. boolean?</p>

        <div class="Example">
          <div id="errormessage9"></div>
        </div>

        <script>
            require(['narrative_paths'], () => {
                require([
                    'jquery',
                    'widgets/common/ErrorMessage',
                    'jsonrpc/1.1/errors',
                    'jsonrpc/1.1/jsonrpcErrors',
                    'kb_common/jsonRpc/exceptions',
                ], (
                    $,
                    $ErrorMessage,
                    errors,
                    jsonrpcErrors,
                    jsonrpcExceptions
                ) => {
                    function renderExample(id, fun) {
                        const $renderTarget = $(`#${id}`);
                        if (!$renderTarget) {
                            console.error(`Sorry, id ${id} does not exist`);
                            return;
                        }
                        try {
                            $renderTarget.html(fun());
                        } catch (ex) {
                            $renderTarget.html($('<div class="alert alert-danger">').append(ex.message));
                        }
                    }
                    renderExample('errormessage1', () => {
                        return $ErrorMessage("This is a string error");
                    });
                    renderExample('errormessage2', () => {
                        return $ErrorMessage(new Error("This is a general error"));
                    });
                    renderExample('errormessage3', () => {
                        const error = new errors.ClientError(
                            'Client Error Message',
                            {
                                url: 'https://example.com',
                                method: 'SomeMethod',
                                params: {
                                    param1: 'Param 1',
                                    param2: 12345,
                                    param3: 1,
                                    param4: 0,
                                    param5: [2, 'Hello'],
                                    param6: {another: 'Param'}
                                },
                                originalMessage: 'This is an original error message'
                            }
                        );
                       return $ErrorMessage(error);
                    });
                     renderExample('errormessage3b', () => {
                        const error = new jsonrpcErrors.JSONRPCError(
                            'JSON-RPC Error Message',
                            {
                                url: 'https://example.com',
                                method: 'SomeMethod',
                                params: {
                                    param1: 'Param 1',
                                    param2: 12345,
                                    param3: 1,
                                    param4: 0,
                                    param5: [2, 'Hello'],
                                    param6: {another: 'Param'}
                                },
                                error: {
                                    code: 123,
                                    name: 'Service Error Name',
                                    message: 'Error Message',
                                    error: 'the error\nstack\nhere'
                                }
                            }
                        );
                       return $ErrorMessage(error);
                    });
                    renderExample('errormessage4', () => {
                        const error = new jsonrpcExceptions.JsonRpcError(
                            'FooModule',
                            'foo_func',
                            {
                                    param1: 'Param 1',
                                    param2: 12345,
                                    param3: 1,
                                    param4: 0,
                                    param5: [2, 'Hello'],
                                    param6: {another: 'Param'}
                            },
                            'https://example.com',
                            {
                                code: 123,
                                name: 'Service Error Name',
                                message: 'Error Message',
                                error: 'Description of the error here',
                                stack: 'the error\nstack\nhere'
                            }
                        );
                       return $ErrorMessage(error);
                    });
                    renderExample('errormessage5', () => {
                        return $ErrorMessage(null);
                    });

                    renderExample('errormessage6', () => {
                        return $ErrorMessage(new Date());
                    });

                    renderExample('errormessage7', () => {
                        return $ErrorMessage({message: 'Hello, I am a message'});
                    });

                    renderExample('errormessage8', () => {
                        class FooError extends Error {
                            toJSON() {
                                return {
                                    prop1: "Property 1",
                                    prop2: 123,
                                    prop3: {
                                        yet: "more props"
                                    }
                                }
                            }
                        }
                        return $ErrorMessage(new FooError('I am a foo error!'));
                    });

                     renderExample('errormessage9', () => {
                        return $ErrorMessage(true);
                    });
                });
            });
        </script>
    </body>
</html>